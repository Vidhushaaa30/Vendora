<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vendora Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
    </style>
</head>
<body class="bg-blue-50 min-h-screen p-4 flex items-center justify-center">

    <div id="app-container" class="bg-white shadow-xl rounded-2xl p-6 w-full max-w-4xl">
        <div class="flex justify-between items-center mb-6">
            <h1 class="text-3xl font-extrabold text-blue-600">Vendora Owner Dashboard</h1>
            <div class="text-sm text-gray-500">
                User ID: <span class="font-mono text-xs">local-prototype-user</span>
            </div>
        </div>
        <div class="flex gap-4 mb-8">
            <button id="add-bills-btn" class="flex items-center justify-center px-6 py-3 bg-blue-600 text-white font-semibold rounded-full shadow-lg hover:bg-blue-700 transition-colors">
                Add Sample Bills
            </button>
            <button id="run-fraud-btn" class="flex items-center justify-center px-6 py-3 bg-indigo-600 text-white font-semibold rounded-full shadow-lg hover:bg-indigo-700 transition-colors">
                Run Fraud Detection
            </button>
        </div>
        <div id="content-area">
            <div class="text-center py-12 text-lg text-gray-500">No bills found. Click 'Add Sample Bills' to get started.</div>
        </div>
    </div>

    <script type="text/javascript">
        // --- Global State Variables ---
        let bills = [];

        /**
         * Renders the bills list based on the current state.
         */
        function renderBills() {
            const contentArea = document.getElementById('content-area');
            if (!contentArea) return;

            // Clear previous content
            contentArea.innerHTML = '';

            if (bills.length === 0) {
                contentArea.innerHTML = `<div class="text-center py-12 text-lg text-gray-500">No bills found. Click 'Add Sample Bills' to get started.</div>`;
            } else {
                const billsListHtml = bills.map(bill => {
                    return `
                        <div class="p-5 rounded-xl shadow-sm transition-all duration-300 ${bill.isFraud ? 'bg-red-100 border-2 border-red-500' : 'bg-blue-100 border border-blue-300'}">
                            <div class="flex items-center justify-between">
                                <h2 class="text-xl font-bold">
                                    Invoice: <span class="font-mono text-gray-700">${bill.invoiceNumber}</span>
                                </h2>
                                ${bill.isFraud ? `<span class="bg-red-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide">Fraud Alert</span>` : ''}
                                ${bill.isRandomFraud ? `<span class="bg-orange-600 text-white text-xs font-bold px-3 py-1 rounded-full uppercase tracking-wide ml-2">Random Flag</span>` : ''}
                            </div>
                            <div class="mt-2 text-sm text-gray-600 space-y-1">
                                <p><strong>Employee:</strong> ${bill.employeeName}</p>
                                <p><strong>Quantity:</strong> ${bill.quantity}</p>
                                <p><strong>Amount:</strong> $${bill.amount}</p>
                                <p><strong>Date:</strong> ${new Date(bill.date).toLocaleDateString()}</p>
                            </div>
                        </div>
                    `;
                }).join('');
                contentArea.innerHTML = `<div class="space-y-4">${billsListHtml}</div>`;
            }
        }

        /**
         * Adds a list of randomly generated bills to a local in-memory array.
         */
        function addSampleBills() {
            const employeeNames = ['Alex', 'Bella', 'Charles', 'Diana', 'Ethan', 'Fiona'];
            const numberOfBills = Math.floor(Math.random() * 11) + 5; // 5 to 15 bills
            const sampleData = [];

            // Generate random bills
            for (let i = 0; i < numberOfBills; i++) {
                sampleData.push({
                    employeeName: employeeNames[Math.floor(Math.random() * employeeNames.length)],
                    invoiceNumber: `INV-${Math.floor(Math.random() * 1000) + 1}`,
                    quantity: Math.floor(Math.random() * 20) + 1,
                    amount: (Math.floor(Math.random() * 500) + 10),
                    date: new Date().toISOString()
                });
            }

            // Manually add some duplicates to guarantee fraud detection works
            if (sampleData.length > 2) {
                const index1 = Math.floor(Math.random() * sampleData.length);
                const index2 = Math.floor(Math.random() * sampleData.length);
                sampleData[index2].invoiceNumber = sampleData[index1].invoiceNumber;
                sampleData[index2].quantity = sampleData[index1].quantity;
            }

            bills = sampleData.map((bill, index) => ({ ...bill, id: `local-${index}`, isRandomFraud: false, isFraud: false }));

            renderBills();
        }

        /**
         * Runs the fraud detection logic on the current bills.
         */
        function runFraudDetection() {
            const newBills = bills.map(bill => ({ ...bill, isFraud: false, isRandomFraud: false }));
            const seen = new Map(); // Key: invoiceNumber_quantity, Value: index of first seen bill

            newBills.forEach((bill, index) => {
                // Rule 1: Check for duplicate invoice number and quantity
                const key = `${bill.invoiceNumber}_${bill.quantity}`;
                if (seen.has(key)) {
                    // Mark both the current bill and the previously seen one as fraudulent
                    newBills[index].isFraud = true;
                    newBills[seen.get(key)].isFraud = true;
                } else {
                    seen.set(key, index);
                }

                // Rule 2: Randomly flag some bills (5% chance)
                if (Math.random() < 0.05) {
                    newBills[index].isRandomFraud = true;
                }
            });

            bills = newBills;
            renderBills();
        }

        // Add event listeners on initial load
        document.addEventListener('DOMContentLoaded', () => {
            document.getElementById('add-bills-btn').addEventListener('click', addSampleBills);
            document.getElementById('run-fraud-btn').addEventListener('click', runFraudDetection);
        });
    </script>
</body>
</html>